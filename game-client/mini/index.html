<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>WS Test</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#111;color:#eee;font:14px/1.5 system-ui;padding:12px;display:flex;flex-direction:column;gap:10px;min-height:100vh}
.r{display:flex;gap:8px;flex-wrap:wrap}
button{background:#0af;color:#000;border:none;padding:9px 12px;border-radius:6px;font-weight:600;cursor:pointer;flex:1;min-width:90px}
button:disabled{opacity:.4;cursor:not-allowed}
input,textarea{flex:1;padding:9px;border:1px solid #444;border-radius:6px;background:#222;color:#eee}
#log{flex:1;background:#000;padding:10px;border-radius:6px;overflow:auto;font-family:monospace;font-size:13px;max-height:50vh}
.m{margin:3px 0}
.o{color:#4ade80}
.l{color:#fb923c}
.e{color:#ff4d4d}
.s{color:#a5b4fc}
.r{color:#c084fc}
</style>
</head>
<body>
<div class="r"><input id="h" value="echo.websocket.org"><button id="i">Init</button></div>
<div class="r"><button id="c">Connect</button><button id="d">Disconnect</button><button id="r">Reconnect</button><button id="a">Autoconnect</button></div>
<div class="r"><button id="ss">Str</button><button id="sn">Num</button><button id="so">Obj</button><button id="sa">Arr</button></div>
<div class="r"><button id="su8">U8</button><button id="su16">U16</button><button id="su32">U32</button><button id="sb">Buf</button></div>
<div class="r"><button id="s1">100</button><button id="s2">1000</button></div>
<div id="log"></div>

<script type="module">
import {W as S}from'./W.js';
const $=i=>document.getElementById(i),L=(t,c='')=>{const d=document.createElement('div');d.className=`m ${c}`;d.textContent=`[${new Date().toLocaleTimeString()}] ${t}`;$('log').appendChild(d);d.scrollIntoView()};
let s=null,U=()=>`wss://${$('h').value.trim()||'echo.websocket.org'}`;
const I=()=>{try{s=new S(U());s.n('o',()=>L('Kết nối OK','o'));s.n('l',()=>L('Ngắt','l'));s.n('e',e=>L(`Lỗi: ${e.message||e}`,'e'));s.n('f',()=>L('Reconnect fail','e'));
s.n('m',d=>{if(d instanceof ArrayBuffer){const u=new Uint8Array(d),h=[...u].map(b=>b.toString(16).padStart(2,'0')).join(' '),v=new Uint16Array(d),w=new Uint32Array(d);
L(`← Bytes ${d.byteLength} | Hex: ${h}`,'r');L(`   U8: [${[...u].join(', ')}]`,'r');
if(v.length)L(`   U16: [${[...v].join(', ')}]`,'r');if(w.length)L(`   U32: [${[...w].join(', ')}]`,'r')
}else L(`← ${typeof d==='object'?JSON.stringify(d):d}`,'r')});
L('Init OK');$('i').disabled=1}catch(e){L(`Init lỗi: ${e.message}`,'e')}};
$('i').onclick=I;$('c').onclick=()=>{try{s.C()}catch(e){L(e.message,'e')}};$('d').onclick=()=>{try{s.D()}catch(e){L(e.message,'e')}};$('r').onclick=()=>{try{s.R()}catch(e){L(e.message,'e')}};$('a').onclick=()=>{try{s.A()}catch(e){L(e.message,'e')}};
const G=(d,t='')=>{try{if(t==='b'){s.B(d);const u=new Uint8Array(d.buffer||d);L(`→ [${t}] ${d instanceof ArrayBuffer?'Buf':d.constructor.name} [${[...u].join(', ')}]`,'s')
}else{s.S(d);L(`→ [${t}] ${typeof d==='object'?JSON.stringify(d):d}`,'s')}}catch(e){L(e.message,'e')}};
$('ss').onclick=()=>G('Hello WS! Tiếng Việt OK','s');$('sn').onclick=()=>G(987654321,'s');$('so').onclick=()=>G({a:'test',r:Math.random(),t:Date.now()});$('sa').onclick=()=>G([1,'x',null,{y:2},true,[3,4]]);
$('su8').onclick=()=>{const a=new Uint8Array(8);crypto.getRandomValues(a);G(a,'b')};$('su16').onclick=()=>{const a=new Uint16Array(4);crypto.getRandomValues(a);G(a,'b')};$('su32').onclick=()=>{const a=new Uint32Array(2);crypto.getRandomValues(a);G(a,'b')};$('sb').onclick=()=>{const b=new ArrayBuffer(16),v=new Uint8Array(b);crypto.getRandomValues(v);G(b,'b')};
const M=n=>{for(let i=0;i<n;i++)G({i,t:Date.now(),r:Math.random()},'b')};$('s1').onclick=()=>M(100);$('s2').onclick=()=>M(1000);
</script>
</body>
</html>
