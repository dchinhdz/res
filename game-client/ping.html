<!DOCTYPE html>
<html>
<head>
  <title>Ping WebSocket</title>
  <style>
    body { font-family: monospace; padding: 20px; }
    #log { white-space: pre; }
  </style>
</head>
<body>
  <h3>WebSocket Ping to echo.websocket.org</h3>
  <div id="log"></div>

  <script>
    const ws = new WebSocket('wss://echo.websocket.org');
    const log = document.getElementById('log');

    ws.onopen = () => {
      const ping = () => {
        if (ws.readyState === WebSocket.OPEN) {
          const start = performance.now();
          ws.pingStart = start; // lưu thời gian gửi
          ws.send(new Uint8Array ([255])); // gửi "ping"
        }
      };

      ws.onmessage = (e) => {
        if (e.data === 'ping' && ws.pingStart) {
          const ms = Math.round(performance.now() - ws.pingStart);
          log.textContent += `Pong:: ${ms} ms\n`;
          delete ws.pingStart;
        }
      };

      setInterval(ping, 5000);
      ping(); // gửi ngay lần đầu
    };

    ws.onerror = () => log.textContent += 'Lỗi kết nối\n';
    ws.onclose = () => log.textContent += 'Đã đóng kết nối\n';
  </script>
</body>
</html>
