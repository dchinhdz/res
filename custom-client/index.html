<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>Socket Test</title><style>
  body{font:14px monospace;background:#111;color:#0f0;margin:0;padding:10px;overflow:auto}
  button{margin:3px;padding:6px 10px;background:#222;border:1px solid #0f0;color:#0f0;cursor:pointer}
  button:hover{background:#0f0;color:#111}
  #log{max-height:100vh;overflow-y:auto;white-space:pre-wrap;word-break:break-all}
</style></head><body>

<button onclick="sendStr()">String</button>
<button onclick="sendNum()">Number</button>
<button onclick="sendObj()">Object</button>
<button onclick="sendArr()">Array</button>
<button onclick="sendBin()">Binary Pack</button>
<button onclick="sendU8()">U8</button><button onclick="sendI8()">I8</button>
<button onclick="sendU16()">U16</button><button onclick="sendI16()">I16</button>
<button onclick="sendU32()">U32</button><button onclick="sendI32()">I32</button>
<button onclick="sendF32()">F32</button><button onclick="sendF64()">F64</button>

<pre id="log"></pre>

<script type="module">
import { Socket } from './Socket.js';
const $ = document.getElementById('log');
const l = (t, m = '', c = '#0f0') => {
  const n = new Date().toISOString().slice(11,-1);
  $.insertAdjacentHTML('beforeend', `<div style="color:${c}">[${n}] ${t} ${m}</div>`);
  $.scrollTop = $.scrollHeight;
};
let s;
try { s = new Socket('wss://echo.websocket.org'); } catch (e) { l('FATAL', e.message, '#f00'); throw e; }
s.on(onMsg);
const send = (t, d) => { try { s.send(d); l(`→ ${t}`, typeof d === 'object' ? JSON.stringify(d) : d, '#ff0'); } catch (e) { l('SEND ERR', e.message, '#f00'); }};
const sendStr = () => send('String', 'Hello Realtime Game!');
const sendNum = () => send('Number', Math.PI);
const sendObj = () => send('Object', {x:10,y:20,dir:'up',hp:95});
const sendArr = () => send('Array', [1,2,3,'go',[true,false]]);
const sendBin = () => {
  const b = new ArrayBuffer(30), v = new DataView(b); let o = 0;
  v.setUint8(o++,255); v.setInt8(o++,-128);
  v.setUint16(o,65535,true); o+=2; v.setInt16(o,-32768,true); o+=2;
  v.setUint32(o,4294967295,true); o+=4; v.setInt32(o,-2147483648,true); o+=4;
  v.setFloat32(o,3.14159,true); o+=4; v.setFloat64(o,-2.71828,true); o+=8;
  s.send(b); l('→ Binary Pack', `(${b.byteLength}B)`, '#ff0');
};
const sendU8 = () => { const a = new Uint8Array([42]); s.send(a); l('→ Uint8', 42, '#ff0'); };
const sendI8 = () => { const a = new Int8Array([-99]); s.send(a); l('→ Int8', -99, '#ff0'); };
const sendU16 = () => { const a = new Uint16Array([60000]); s.send(a); l('→ Uint16', 60000, '#ff0'); };
const sendI16 = () => { const a = new Int16Array([-30000]); s.send(a); l('→ Int16', -30000, '#ff0'); };
const sendU32 = () => { const a = new Uint32Array([4000000000]); s.send(a); l('→ Uint32', 4000000000, '#ff0'); };
const sendI32 = () => { const a = new Int32Array([-2000000000]); s.send(a); l('→ Int32', -2000000000, '#ff0'); };
const sendF32 = () => { const a = new Float32Array([1.234567]); s.send(a); l('→ Float32', 1.234567, '#ff0'); };
const sendF64 = () => { const a = new Float64Array([Math.E]); s.send(a); l('→ Float64', Math.E, '#ff0'); };

function onMsg(d) {
  if (typeof d === 'string') return l('← String', d, '#0ff');
  if (d instanceof ArrayBuffer) {
    const v = new DataView(d), o = d.byteLength, s = `← Binary (${o}B): `;
    if (o===1) l(s + `U8=${new Uint8Array(d)[0]} I8=${new Int8Array(d)[0]}`, '', '#0ff');
    else if (o===2) { const u=v.getUint16(0,true), i=v.getInt16(0,true); l(s + `U16=${u} I16=${i}`, '', '#0ff'); }
    else if (o===4) {
      const u=v.getUint32(0,true), i=v.getInt32(0,true), f=v.getFloat32(0,true);
      l(s + (u>>>0===u ? `U32=${u} I32=${i}` : `F32=${f.toFixed(6)}`), '', '#0ff');
    } else if (o===8) l(s + `F64=${v.getFloat64(0,true).toFixed(6)}`, '', '#0ff');
    else {
      let p=0, a=[];
      a.push(`U8=${v.getUint8(p++)}`); a.push(`I8=${v.getInt8(p++)}`);
      a.push(`U16=${v.getUint16(p,true)}`); p+=2; a.push(`I16=${v.getInt16(p,true)}`); p+=2;
      a.push(`U32=${v.getUint32(p,true)}`); p+=4; a.push(`I32=${v.getInt32(p,true)}`); p+=4;
      a.push(`F32=${v.getFloat32(p,true).toFixed(5)}`); p+=4;
      a.push(`F64=${v.getFloat64(p,true).toFixed(5)}`);
      l(s + a.join(' | '), '', '#0ff');
    }
    return;
  }
  try { l('← JSON', JSON.stringify(d), '#0ff'); } catch { l('← UNKNOWN', d, '#f00'); }
}
</script>
</body></html>
