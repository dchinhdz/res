<html>
  <head>
    <title>TEST CLIENT</title>
    <style>
      * {margin: 10px;background-color: #000;color:#fff}
      #log {border: 4px solid #ff0;overflow-y: scroll;max-height: 50vh}
    </style>
  </head>
  <body>
    <h2>TEST WEBSOCKET üê¶</h2>
    <div id="log"></div>
    <button type="button" onclick="statusCheck();">STATUS</button>
    <button type="button" onclick="clearLog();">CLEAR</button>
    <button type="button" onclick="emitS('str');">STRING</button>
    <button type="button" onclick="emitS('obj');">OBJECT</button>
    <button type="button" onclick="emitS('bin');">BINARY</button>
    <button type="button" onclick="emitS('move');">MOVE</button>
    <button type="button" onclick="emitS('cmd');">CMD</button>
    <script type="module">
      import {S} from './S.js';
      import {A} from './A.js';
      import {R} from './R.js';
      const ws = new S('wss://websocket-echo.com');
      const div = document.getElementById("log");
      function log(text) {
        let iv = document.createElement("div");
        iv.textContent = `[${new Date().toLocaleTimeString()}] üì© ${text}`;
        div.appendChild(iv);
      }
      window.statusCheck = () => {
        log(`Status Websocket: ${ws.s()} | check Act: ${typeof A} | check Read: ${typeof R}`);
      }
      window.clearLog = () => {
        div.innerHTML = '';
        log('clean log...');
      }
      window.emitS = (type) => {
        if (ws.s() !== 1) return log('Websocket ch∆∞a s·∫µn s√†ng!');
        if (type === 'move') {
          ws.e(A.m(10, 133.4, 23.6));
          log('EMIT: MOVE');
        } else if(type === 'obj') {
          ws.e(R.s({a: 1, b: 2}));
          log('EMIT: JSON');
        } else if(type === 'str') {
          ws.e('Hello String!');
          log('EMIT: STRING');
        } else if(type === 'bin') {
          ws.e(A.s(20, 'Hello Bytes'));
          log('EMIT: BINARY');
        } else if(type === 'cmd') {
          ws.e(A.c(30, 5351));
          log('EMIT: CMD');
        } else {
          log('D·ªØ li·ªáu g·ª≠i kh√¥ng ƒë√∫ng!');
        }
      }
      try {
        ws.o("o", () => log('‚úÖ CONNECTED!'));
        ws.o("e", (e) => log('‚ö†Ô∏è ERROR!'));
        ws.o("c", () => log('‚ùå DISCONNECT!'));
        ws.o("m", (e) => {
          if (A.iB(e.data)) {
            const channel = A.gC(e.data);
            if (channel === 1) {
               log('RE MOVE: '+R.s(A.M(e.data)));
             } else if(channel === 20) {
               log('RE BINARY STRING: '+R.s(A.S(e.data))+` => ${R.b(A.S(e.data))}`);
             } else if(channel === 30) {
               log('RE CMD: '+R.s(A.C(e.data)));
             } else {log('Channel kh√¥ng h·ª£p l·ªá');}
          } else {
             log('RECEIVE: '+e.data);
          }
        });
      } catch {
        log('Syntax Error...'); 
      }
    </script>
  </body>
</html>
