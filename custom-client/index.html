<html>
  <head>
    <title>TEST CLIENT</title>
    <style>
      * {margin: 10px;background-color: #000;color:#fff}
      #log {border: 4px solid #ff0;overflow-y: scroll;max-height: 50vh}
    </style>
  </head>
  <body>
    <h2>TEST WEBSOCKET @</h2>
    <div id="log"></div>
    <button type="button" onclick="statusCheck();">STATUS</button>
    <button type="button" onclick="clearLog();">CLEAR</button>
    <button type="button" onclick="emitS('str');">STRING</button>
    <button type="button" onclick="emitS('obj');">OBJECT</button>
    <button type="button" onclick="emitS('bin');">BINARY</button>
    <button type="button" onclick="emitS('move');">MOVE</button>
    <button type="button" onclick="emitS('cmd');">CMD</button>
    <script type="module">
      import {Socket} from './Socket.js';
      import {Act} from './Act.js';
      import {Read} from './Read.js';
      const ws = new Socket('wss://echo.websocket.org');
      const div = document.getElementById("log");
      function log(text) {
        let iv = document.createElement("div");
        iv.textContent = `[${new Date().toLocaleTimeString()}] üì© ${text}`;
        div.appendChild(iv);
      }
      window.statusCheck = () => {
        log(`Status Websocket: ${ws.status()} | check Act: ${typeof Act} | check Read: ${typeof Read}`);
      }
      window.clearLog = () => {
        div.innerHTML = '';
        log('clean log...');
      }
      window.emitS = (type) => {
        if (ws.status() !== 1) return log('Websocket ch∆∞a s·∫µn s√†ng!');
        if (type === 'move') {
          ws.emit(Act.move(10, 133.4, 23.6));
          log('EMIT: MOVE');
        } else if(type === 'obj') {
          ws.emit(JSON.stringify({a: 1, b: 2}));
          log('EMIT: JSON');
        } else if(type === 'str') {
          ws.emit('Hello String!');
          log('EMIT: STRING');
        } else if(type === 'bin') {
          ws.emit(Act.str(20, 'Hello Bytes'));
          log('EMIT: BINARY');
        } else if(type === 'cmd') {
          ws.emit(Act.cmd(30, 5351));
          log('EMIT: CMD');
        } else {
          log('D·ªØ li·ªáu g·ª≠i kh√¥ng ƒë√∫ng!');
        }
      }
      try {
        ws.on("open", () => log('‚úÖ CONNECTED!'));
        ws.on("error", (e) => log('‚ö†Ô∏è ERROR!'));
        ws.on("close", () => log('‚ùå DISCONNECT!'));
        ws.on("message", (e) => {
          if (Act.isBinary(e.data)) {
            const channel = Act.getChannel(e.data);
            if (channel === 1) {
               log('RE MOVE: '+JSON.stringify(Act.onMove(e.data)));
             } else if(channel === 20) {
               log('RE BINARY STRING: '+JSON.stringify(Act.onStr(e.data))+` => ${Read.str(Act.onStr(e.data))}`);
             } else if(channel === 30) {
               log('RE CMD: '+JSON.stringify(Act.onCmd(e.data)));
             } else {log('Channel kh√¥ng h·ª£p l·ªá');}
          } else {
             log('RECEIVE: '+e.data);
          }
        });
      } catch {
        log('Syntax Error...'); 
      }
    </script>
  </body>
</html>
